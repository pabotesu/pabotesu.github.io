<!doctype html><html lang=ja-jp>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=icon href=https://pabotesu.github.io/favicon.ico>
<link rel=stylesheet href=/css/style.min.css>
<meta property="og:site_name" content="/var/log/pabotesu">
<meta property="og:title" content="20230430 Build Misskeyserver">
<meta property="og:type" content="website">
<meta property="og:url" content="https://pabotesu.github.io/posts/20230430-build-misskeyserver/">
<meta property="og:description" content="my-post-contents">
<meta name=description content="my-post-contents">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:title content="20230430 Build Misskeyserver">
<meta name=twitter:description content="my-post-contents">
<title>
20230430 Build Misskeyserver - /var/log/pabotesu
</title>
<style>@import "https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css";code{font-family:fira code,monospace}</style>
<script type=module>
  import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe-lightbox.esm.min.js';
  const lightbox = new PhotoSwipeLightbox({
    gallery: '.post-content',
    children: '.pswp-child',
    pswpModule: () => import('https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe.esm.min.js')
  });
  lightbox.init();
</script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@5.3.4/dist/photoswipe.min.css>
</head>
<body>
<div id=main>
<header>
<nav>
<div class=site-logo>
<a class=no-decoration href=https://pabotesu.github.io>
/var/log/pabotesu
</a>
</div>
<div class=menu-item>
<span id=menu-button>menu</span>
</div>
</nav>
<div id=popup-menu class=hide>
<ul>
<li>
<a href=/about class=no-decoration>About</a>
</li>
<li>
<a href=/archives class=no-decoration>Archives</a>
</li>
<li>
<a href=/tags class=no-decoration>Tags</a>
</li>
</ul>
</div>
</header>
<div class=content>
<ol class=breadcrumb>
<li><a href=https://pabotesu.github.io/>Home</a>
<li><a href=https://pabotesu.github.io/posts/>Posts</a>
<li>20230430 Build Misskeyserver
</ol>
</ol>
<span class=post-title data-pagefind-body>20230430 Build Misskeyserver</span>
<div class=post-meta>
<span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<time>2023-04-30 12:07:41</time>
</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg>
<a href=https://github.com/pabotesu/pabotesu.github.io/tree/main/content/posts/20230430-build-misskeyserver.md target=_blank rel="noopener noreferrer">History</a>
</span>
<div>
<span>
<a href=https://pabotesu.github.io/tags/misskey/>#misskey</a>
</span>
<span>
<a href=https://pabotesu.github.io/tags/linux/>#linux</a>
</span>
</div>
</div>
<div class=toc>
<details>
<summary>Toc</summary>
<nav id=TableOfContents>
<ul>
<li><a href=#misskeyサーバを実装する>Misskeyサーバを実装する</a>
<ul>
<li><a href=#実装について>実装について</a></li>
<li><a href=#実装の流れ>実装の流れ</a></li>
<li><a href=#構成実装例>構成（実装例）</a></li>
<li><a href=#実装後>実装後</a></li>
<li><a href=#おまけ>おまけ</a></li>
<li><a href=#参考>参考</a></li>
</ul>
</li>
</ul>
</nav>
</details>
</div>
<article class=post-content data-pagefind-body>
<h2 id=misskeyサーバを実装する>Misskeyサーバを実装する&nbsp;<a class=headline-hash href=#misskeyサーバを実装する>#</a> </h2>
<h3 id=実装について>実装について&nbsp;<a class=headline-hash href=#実装について>#</a> </h3>
<ul>
<li>実装対象：misskeyサーバ</li>
<li>利用リソース：自宅サーバ、cloudflare</li>
<li>ハイパバイザ：proxmox</li>
</ul>
<h3 id=実装の流れ>実装の流れ&nbsp;<a class=headline-hash href=#実装の流れ>#</a> </h3>
<ol>
<li>proxmox上に仮想マシン立ち上げ、misskeyサーバを構成する</li>
<li>cloudflareにてCDN設定</li>
</ol>
<h3 id=構成実装例>構成（実装例）&nbsp;<a class=headline-hash href=#構成実装例>#</a> </h3>
<p><a href=https://thxdaddy.xyz/ target=_blank rel="noopener noreferrer">https://thxdaddy.xyz/</a>
</p>
<hr>
<p>1. proxmox上に仮想マシン立ち上げ、misskeyサーバを構成する</p>
<ul>
<li>
<p>以下参考にmisskeyサーバを実装いたしました。
<a href=https://misskey-hub.net/docs/install/manual.html target=_blank rel="noopener noreferrer">Misskey構築の手引き</a>
</p>
</li>
<li>
<p>proxmoxの様子
<img src=/img/20230430-build-misskeyserver/20230607-1941_proxmox.png alt=20230607-194100_proxmox>
</p>
</li>
</ul>
<p>2. cloudflareにてCDN設定</p>
<ul>
<li>
<p>以下のようにCloudFlare<code>Zero Trust</code>のTunnnelを設定
<img src=/img/20230430-build-misskeyserver/20230607-2053_cloudflare.JPG alt=20230607-2053_cloudflare>
</p>
</li>
<li>
<p>その後、<code>1. proxmox上に仮想マシン立ち上げ、misskeyサーバを構成する</code>
にて実装したサーバに<code>cloudflareのAPI</code>のインストールと
<code>設定したトンネルの接続コマンド（設定時提示されます。）</code>を実行します。</p>
</li>
<li>
<p>基本的に以上でサーバを公開できます。</p>
</li>
</ul>
<h3 id=実装後>実装後&nbsp;<a class=headline-hash href=#実装後>#</a> </h3>
<ul>
<li>これで一国一城の主となったわけです・・・</li>
</ul>
<h3 id=おまけ>おまけ&nbsp;<a class=headline-hash href=#おまけ>#</a> </h3>
<ul>
<li>
<p>Misskey v13でAn error has occurred!が発生する
<img src=/img/20230430-build-misskeyserver/20230607-2051_misskeyerror.png alt=20230607-2051_misskeyerror>
</p>
<ul>
<li>
<p>以下記載のようにCloudflareのAuto Minifyの影響のようです。</p>
<ul>
<li>CloudFlareで構成ルール等を使ってAuto Minifyをオフにすると解決します。</li>
</ul>
<p><a href=https://github.com/misskey-dev/misskey/issues/9791 target=_blank rel="noopener noreferrer">Misskey is not opening properly in 13.3.1 #9791</a>
</p>
</li>
</ul>
</li>
<li>
<p>実際に動いてるサーバくん</p>
</li>
</ul>
<p>
<img src=/img/20230430-build-misskeyserver/20230206_1910_runningserver.jpg alt=20230206_1910_runningserver>
</p>
<h3 id=参考>参考&nbsp;<a class=headline-hash href=#参考>#</a> </h3>
<ul>
<li><a href=https://misskey-hub.net/docs/install/manual.html target=_blank rel="noopener noreferrer">Misskey構築の手引き</a>
</li>
</ul>
</article>
<div class=post-nav>
<span class=post-nav-next>
<a href=https://pabotesu.github.io/posts/20230604-staticpage_on_aws/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
<br>
20230604 StaticPage_on_aws
</a>
</span>
<span class=post-nav-prev>
<a href=https://pabotesu.github.io/posts/20230322-aws_autoscaling/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
<br>
AWSにおけるAuto Scalingに関する一検討 with Terraform
</a>
</span>
</div>
<script src=https://utteranc.es/client.js repo=pabotesu/pabotesu.github.io issue-term=pathname theme=preferred-color-scheme crossorigin=anonymous async></script>
</div>
<footer>
<div class=footer-text>&copy; 2023 pabotesu Powered by <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a></div>
</footer>
</div>
<script src=/js/script.min.js></script>
</body>
</html>